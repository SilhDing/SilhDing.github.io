## Stack applications

Using scrap to solve problems is very common, especially in string decoding (such as parenthesis). Here are some advanced examples on this method.

### 394 Decode String

Given an encoded string, return its decoded string.

The encoding rule is: `k[encoded_string]`, where the `encoded_string` inside the square brackets is being repeated exactly k times. Note that k is guaranteed to be a positive integer.

You may assume that the input string is always valid; No extra white spaces, square brackets are well-formed, etc.

Furthermore, you may assume that the original data does not contain any digits and that digits are only for those repeat numbers, `k`. For example, there won't be input like `3a` or `2[4]`.

    s = “3[a]2[bc]”, return “aaabcbc”.
    s = “3[a2[c]]”, return “accaccacc”.
    s = “2[abc]3[cd]ef”, return “abcabccdcdcdef”.
    
The most intuitive way is to use stack. However, it is not so easy to implement as it involves letters and numbers. So the implementation may be complicated: we can use two stacks; one for letter and one for number.

```java
class Solution {
    public String decodeString(String s) {
        // Rules:
        // 1. number: accumulate number
        // 2. letter: accumulate current sb
        // 3. [: new word is coming; push the old one
        // 4. ]: append the new word
        Stack<String> rStack = new Stack<>();
        Stack<Integer> nStack = new Stack<>();
        StringBuilder sb = new StringBuilder();
        StringBuilder res = new StringBuilder();
        int num = 0;
        for (char c: s.toCharArray()) {
            if (Character.isDigit(c)) {
                num = num* 10 + (c - '0');
            } else if (c == '[') {
                nStack.push(num);
                rStack.push(sb.toString());
                sb.setLength(0);
                num = 0;
            } else if (c == ']') {
                StringBuilder tmp = new StringBuilder(rStack.pop());
                int count = nStack.pop();
                for (int i = 0; i < count; i++) {
                    tmp.append(sb);
                }
                sb = tmp;
            } else {
                sb.append(c);
            }
        }
        return sb.toString();
    }
}
```

The trickiest part if what we should do when we have `]` incoming. 


### 224 Basic Calculator

Implement a basic calculator to evaluate a simple expression string.

The expression string may contain open ( and closing parentheses ), the plus + or minus sign -, non-negative integers and empty spaces .

    Input: “(1+(4+5+2)-3)+(6+8)”
    Output: 23
    
This is also a good example that uses stack smartly. The code is in fact self-explanatory.

```java
class Solution {
    public int calculate(String s) {
        // still use stack
        // -/+:  set running sum is 0 and update sign, and update result
        // number: update running sum
        // (: save the current running sum and sign
        // ): restore the last signa dn running sum
        // one thing we need to note is that, is there is no ( and ), 
        // we in fact do not need stack
        
        int res = 0;
        int runningSum = 0;
        int sign = 1;
        Stack<Integer> stack = new Stack<>();
        
        for (char c: s.toCharArray()) {
            if (Character.isDigit(c)) {
                runningSum = runningSum*10 + (c - '0');
            } else if (c == '+') {
                res += runningSum * sign;
                sign = 1;
                runningSum = 0;
            } else if (c == '-') {
                res += runningSum * sign;
                sign = -1;
                runningSum = 0;
            } else if (c == '(') {
                stack.push(res);
                stack.push(sign);
                sign = 1;
                res = 0;
                // runningSum = 0; // not necessary, as it is set as 0 when c == -/+
            } else if (c == ')') {
                res += runningSum * sign;
                sign = stack.pop();
                res = sign * res + stack.pop();
                runningSum = 0;
            }
        }
        res += runningSum * sign;
        return res;
    }
}
```

### Basic Calculator II

Implement a basic calculator to evaluate a simple expression string.

The expression string contains only non-negative integers, `+`, `-`, `*`, `/` operators and empty spaces . The integer division should truncate toward zero.

    Input: “ 3+5 / 2 “
    Output: 5
    
The solution is not hard to understand, but once again, not easy to implement.

```java
class Solution {
    public int calculate(String s) {
        char lastOp = '+';
        int num = 0; // priority result
        int res = 0;
        int pResult = 0;
        for (int i = 0; i < s.length(); i++) {
            char c = s.charAt(i);
            if (Character.isDigit(c)) {
                num = 10 * num + (c - '0');
            }
            
            if (i == s.length() - 1 || c == '+' || c == '-' || c == '*' || c == '/') {
                if (lastOp == '+') pResult += num;
                if (lastOp == '-') pResult -= num;
                if (lastOp == '*') pResult *= num;
                if (lastOp == '/') pResult /= num;
                
                num = 0;
                lastOp = c;
                if (i == s.length() - 1 || c == '+' || c == '-') {
                    res += pResult;
                    pResult = 0;
                }
            }
        }
        return res;
    }
}
```

