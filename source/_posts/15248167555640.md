## Docker使用心得

最近leader让我把完成的项目创建成镜像，这里有几个心得可以写一下。

项目的主要特点是非常庞大，需要的依赖包和支持文件非常多，同时项目中的Dockerfile已经年代十分久远，所以尝试了很久才完成，主要有这么几个点需要注意。

#### 关于yum的使用

一般来说基础镜像是`linux`系统， 其中`centos`又用得最多，`yum`命令是常用的package安装指令，非常好用。请注意，yum的源一般由系统指定，一般在系统这个目录下：`etc/yum.repos.d/`。必要时可以安装新的yum源。

第二，在Dockerfile里，和通常情况下的`terminal`端执行命令不一样，我们所有的系统询问，需要自动设置输入，可以用 `-y`参数表示“所有回答是”。这样一来在Docker文件下的yum安装应该这么写：

	RUN yum update -y
	RUN yum install -y \
	    gcc \
	    openssh-server \
	    ...

否则，在系统询问用户时，整个镜像构建会自动退出，从而构建失败。

#### 请注意选择合适的基础镜像

如果只是个人用户的话那么其实无所谓，一般来说基础镜像都是官方镜像，在Dockerfile的最前说明就好。但是如果是公司业务开发，那么请使用公司registry下的标准镜像文件。比如爱奇艺官方的centos已经安装公司私有包，这个时候你要是还傻傻地在官方镜像中配环境，你会死的我跟你说。

#### 是否要使用commit?

`commit`的作用其实很明显，在对一个容器改变了其容器存储时，假如容器最后停止并删除，那么所有的改动将会消失。镜像不会收到任何的改变。这个时候，使用`commit`可以保存改动并创建一个新的镜像。一个标准的`commit`格式为：
    
`docker commit [选项] <容器ID或容器名> [<仓库名>[:<标签>]]`

一个例子：

```Bash
$ docker commit \
    --author "dingyihang_sx <dingyihang_sx@qiyi.com>" \
    --message "update repo list in centos7" \
    0e32937493un3y \
    docker-registry.qiyi.virtual/dingyihang_sx/centos7-vtc-admin:0.1
```
      
但是，请尽量不要使用commit来构建一个镜像。首先，会有很多多余的操作使得镜像十分庞大，另外，使用镜像者也无法得知具体的操作信息。所以，请尽量使用`build -f Dockerfile`来构造镜像。比如：

    $ docker build -f Dockerfile -t docker-registry.qiyi.virtual/dingyihang_sx/centos7-vtc-admin:v1 .

看[这里](https://yeasy.gitbooks.io/docker_practice/content/image/commit.html)来了解关于`commit`的更多信息。

#### Google for help

在安装各种package的时候不可避免会碰到很多的安装问题，这些问题一般都可以直接google解决。记住，stackoverflow真的是一个好东西。

先写到这里！
      

      

